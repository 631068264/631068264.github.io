---
layout:     post
rewards: false
title:   k8s常用命令
categories:
    - k8s
---

比较常用命令集合


```bash
# 删除删不掉的pv pvc
kubectl patch $(kubectl get pv,pvc |grep [应用名]|awk '{print $1}') -p '{"metadata":{"finalizers":null}}'

# 删除删不掉pod
kubectl delete $(kubectl get pod |grep [应用名]|awk '{print $1}') --grace-period=0 --force

# 看k8s应用
kubectl get pods,svc,statefulsets -o wide|grep [应用名]

# test run
kubectl run [pod Name] --image=[image Name] -it --rm --restart='Never' --namespace default -- bash

kubectl logs -f pod/[pod name] container

kubectl describe pod/[pod name]

kubectl run mysql-client --image=ubuntu:18.04 -it --rm --restart='Never' --namespace default -- /bin/sh
```



删除stats

```bash
kubectl delete statefulsets <statefulset 名称>
# 删除 StatefulSet 之后，你可能需要单独删除关联的无头服务。
kubectl delete service <服务名称>

#当通过 kubectl 删除 StatefulSet 时，StatefulSet 会被缩容为 0。 属于该 StatefulSet 的所有 Pod 也被删除。 如果你只想删除 StatefulSet 而不删除 Pod，使用 --cascade=orphan。

kubectl delete -f <file.yaml> --cascade=orphan
```



本地端口转发

```bash
NAME    TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)     AGE
mongo   ClusterIP   10.96.41.183   <none>        27017/TCP   11s

kubectl port-forward service/mongo 28015:27017
```

创建一个服务对象来暴露 Deployment

```bash
kubectl expose deployment hello-world --type=NodePort --name=example-service

Name:                   example-service
Namespace:              default
Labels:                 run=load-balancer-example
Annotations:            <none>
Selector:               run=load-balancer-example
Type:                   NodePort
IP:                     10.32.0.16
Port:                   <unset> 8080/TCP
TargetPort:             8080/TCP
NodePort:               <unset> 31496/TCP
Endpoints:              10.200.1.4:8080,10.200.2.5:8080
Session Affinity:       None
Events:                 <none>
```

