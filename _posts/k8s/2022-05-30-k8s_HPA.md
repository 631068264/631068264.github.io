---
layout:     post
rewards: false
title:      k8s HPA
categories:
    - k8s


---

从1.11版本开始，Kubernetes正式弃用Heapster并全面转向基于MetricsServer完成数据采集。MetricsServer将采集到的Pod性能指标数据通过聚合API(AggregatedAPI)如metrics.k8s.io、custom.metrics.k8s.io和extemal.metrics.k8s.io提供给HPA控制器进行查询。



# 工作原理

Kubernetes中的某个MetricsServer持续采集所有Pod副本的指标数据。HPA控制器通过MetricsServer的API获取这些数据，基于用户定义的扩缩容规则进行计算，得到目标Pod的副本数最。
当目标Pod副本数量与当前副本数瘟不同时，HPA控制器就向Pod的副本控制器(Deployment、RC或ReplicaSet)发起scale操作，调整Pod的副本数盘，完成扩缩容操作。