---
layout:     post
rewards: false
title:      事务
categories:
    - mysql
---

**数据库事务的属性－ACID（四个英文单词的首写字母）：**

 - 原子性（Atomicity）

> 所谓原子性就是将一组操作作为一个操作单元，是原子操作，即要么全部执行，要么全部不执行。

 - 一致性（Consistency）

> 事务的一致性指的是在一个事务执行之前和执行之后数据库都必须处于一致性状态。如果事务成功地完成，那么系统中所有变化将正确地应用，系统处于有效状态。如果在事务中出现错误，那么系统中的所有变化将自动地回滚，系统返回到原始状态。

 - 隔离性（Isolation）

> 隔离性指并发的事务是相互隔离的。即一个事务内部的操作及正在操作的数据必须封锁起来，不被其它企图进行修改的事务看到。

 - 持久性（Durability）

> 持久性是指一个事务一旦被提交，它对数据库中数据的改变就是永久性的，接下来的其他操作和数据库故障不应该对其有任何影响。即一旦一个事务提交，DBMS（Database
> Management System）保证它对数据库中数据的改变应该是永久性的，持久性通过数据库备份和恢复来保证。

## 脏读？幻读？不可重复读？



- 脏读(Drity Read)：脏读是指在**一个事务处理过程里读取了另一个未提交的事务中的数据**。当一个事务正在多次修改某个数据，而在这个事务中这多次的修改都还未提交，这时一个并发的事务来访问该数据，就会造成两个事务得到的数据不一致。
- 不可重复读(Non-repeatable read):在**一个事务的两次查询之中数据不一致**，这可能是两次查询过程中间插入了一个事务**更新的原有的数据**。
- 幻读(Phantom Read):在一个事务的**两次查询中数据笔数不一致**，例如有一个事务查询了几列(Row)数据，而另一个事务却在此时**插入了新的几列数据**，先前的事务在接下来的查询中，就会发现有几列数据是它先前所没有的。



## 事务四个隔离级别对比：

| 隔离级别         | 脏读 | 不可重复读 | 幻影读 |
| ---------------- | ---- | ---------- | ------ |
| READ-UNCOMMITTED | √    | √          | √      |
| READ-COMMITTED   | ×    | √          | √      |
| REPEATABLE-READ  | ×    | ×          | √      |
| SERIALIZABLE     | ×    | ×          | ×      |

SQL 标准定义了四个隔离级别：

- READ-UNCOMMITTED(读取未提交)： 最低的隔离级别，允许读取尚未提交的数据变更，可能会**导致脏读、幻读或不可重复读。**

- READ-COMMITTED(读取已提交)： 允许读取并发事务已经提交的数据，**可以阻止脏读，但是幻读或不可重复读仍有可能发生。**

- REPEATABLE-READ(可重复读)： 对同一字段的多次读取结果都是一致的，除非数据是被本身事务自己所修改，**可以阻止脏读和不可重复读，但幻读仍有可能发生。**

- SERIALIZABLE(可串行化)： 最高的隔离级别，完全服从ACID的隔离级别。所有的事务依次逐个执行，这样事务之间就完全不可能产生干扰，也就是说，**该级别可以防止脏读、不可重复读以及幻读。**

  > 这里需要注意的是：Mysql 默认采用的 REPEATABLE_READ隔离级别 Oracle 默认采用的 READ_COMMITTED隔离级别