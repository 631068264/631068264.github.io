---
layout:     post
rewards: false
title:    系统容量估计
categories:
    - 系统架构
---



容量预估往往也是系统架构设计的关键步骤。容量（流量带宽、并发量、数据量）设计是架构师必备的技能之一



# 指标说明

## QPS

Queries Per Second意思是**每秒查询率**，每秒能够响应的查询次数，注意这里的查询是指用户发出请求到服务器做出响应成功的次数

原理：每天80%的访问集中在20%的时间里，这20%时间叫做峰值时间。

公式：( 总PV数 * 80% ) / ( 每天秒数 * 20% ) = 峰值时间每秒请求数(QPS) 。

## TPS

Transactions Per Second 的缩写，每秒处理的事务数。一个事务是指**一个客户机向服务器发送请求然后服务器做出反应的过程。**

客户机在发送请求时开始计时，收到服务器响应后结束计时，以此来计算使用的时间和完成的事务个数。

**区别**

- 针对单接口而言，TPS可以认为是等价于QPS的，

- 比如访问一个页面/index.html，是一个TPS（因为客户机只是**主动**发了一次请求），而访问/index.html页面可能请求了3次服务器比如css、js、index接口，产生了3个QPS。



## 带宽

举个例子，你的网络都是基于 100M 带宽标准搭建的。那么此时如果每一秒会产生 10240 次数据传输，平均每个数据包大小是 10KB，我们来看下是否会遇到瓶颈。

> 100M 带宽的理论传输速率是 12.5MB/ 秒。那么现在每一秒需要传输：10240 次 / 秒 * 10KB = 100MB/ 秒。很明显，带宽远远不够了。

网站带宽= PV / 统计时间(换算到S)*平均页面大小(单位KB)* 8s

## PV/UV

PV(Page View)： 页面访问量，即页面浏览量或点击量，用户每次刷新即被计算一次

UV(Unique Visitor)： 独立访客，统计1天内访问某站点的用户数(以cookie为依据，如同一个用户)

- PV 统计：nginx日志，一般是对所有访问日志数量，进行求和统计
- UV 统计：nginx日志，对remote_addr进行统计，排除remote_addr重复值,进行求和统计。







# 静态资源

# 数据库压力

# API接口访问压力

# 带宽压力